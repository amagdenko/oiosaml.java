<html>

<head>
<meta http-equiv=Content-Type content="text/html; charset=windows-1252">
<meta name=Generator content="Microsoft Word 12 (filtered)">
<title>Simple Claims Aware Web Service</title>
<style>
<!--
 /* Font Definitions */
 @font-face
	{font-family:"Cambria Math";
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Cambria;
	panose-1:2 4 5 3 5 4 6 3 2 4;}
@font-face
	{font-family:Calibri;
	panose-1:2 15 5 2 2 2 4 3 2 4;}
 /* Style Definitions */
 p.MsoNormal, li.MsoNormal, div.MsoNormal
	{margin-top:0in;
	margin-right:0in;
	margin-bottom:10.0pt;
	margin-left:0in;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
h1
	{mso-style-link:"Heading 1 Char";
	margin-top:24.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:14.0pt;
	font-family:"Cambria","serif";
	color:#365F91;}
h2
	{mso-style-link:"Heading 2 Char";
	margin-top:10.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	page-break-after:avoid;
	font-size:13.0pt;
	font-family:"Cambria","serif";
	color:#4F81BD;}
p.MsoListParagraph, li.MsoListParagraph, div.MsoListParagraph
	{margin-top:6.0pt;
	margin-right:0in;
	margin-bottom:0in;
	margin-left:0in;
	margin-bottom:.0001pt;
	line-height:115%;
	font-size:11.0pt;
	font-family:"Calibri","sans-serif";}
span.Heading1Char
	{mso-style-name:"Heading 1 Char";
	mso-style-link:"Heading 1";
	font-family:"Cambria","serif";
	color:#365F91;
	font-weight:bold;}
span.Heading2Char
	{mso-style-name:"Heading 2 Char";
	mso-style-link:"Heading 2";
	font-family:"Cambria","serif";
	color:#4F81BD;
	font-weight:bold;}
p.ConsoleOutput, li.ConsoleOutput, div.ConsoleOutput
	{mso-style-name:"Console Output";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:8.0pt;
	font-family:"Courier New";}
p.ConsoleOutputCxSpFirst, li.ConsoleOutputCxSpFirst, div.ConsoleOutputCxSpFirst
	{mso-style-name:"Console OutputCxSpFirst";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:8.0pt;
	font-family:"Courier New";}
p.ConsoleOutputCxSpMiddle, li.ConsoleOutputCxSpMiddle, div.ConsoleOutputCxSpMiddle
	{mso-style-name:"Console OutputCxSpMiddle";
	margin:0in;
	margin-bottom:.0001pt;
	border:none;
	padding:0in;
	font-size:8.0pt;
	font-family:"Courier New";}
p.ConsoleOutputCxSpLast, li.ConsoleOutputCxSpLast, div.ConsoleOutputCxSpLast
	{mso-style-name:"Console OutputCxSpLast";
	margin-top:0in;
	margin-right:0in;
	margin-bottom:6.0pt;
	margin-left:0in;
	border:none;
	padding:0in;
	font-size:8.0pt;
	font-family:"Courier New";}
.MsoPapDefault
	{margin-bottom:10.0pt;
	line-height:115%;}
@page Section1
	{size:8.5in 11.0in;
	margin:1.0in 1.0in 1.0in 1.0in;}
div.Section1
	{page:Section1;}
 /* List Definitions */
 ol
	{margin-bottom:0in;}
ul
	{margin-bottom:0in;}
-->
</style>

</head>

<body lang=EN-US>

<div class=Section1>

<h1>Simple Claims Aware Web Service</h1>

<p class=MsoNormal>This sample demonstrates how to build a Security Token
Service (STS) using the Microsoft “Geneva” Framework and issue SAML security
tokens which contain claims. In this sample, the client is a Windows
Communication Framework (WCF) application that sends messages to the STS and to
the “relying party” WCF service using the WS-Trust specification. The WCF
client requests a SAML token from the STS using Windows authentication and
message security. After the STS issues the SAML token, the client will secure
messages sent to the relying party using this security token using message
security.</p>

<p class=MsoNormal>The STS in this sample demonstrates how to override the
GetScope and GetOutputClaimsIdentity methods in the SecurityTokenService class.
The GetScope method verifies that the intended recipient of the token to be
issued is accurate and valid and generates a Scope object. The Scope contains
the credentials the STS will use to sign and encrypt the issued token. The
Scope class is a convenient class to extend with any additional data that may
be relevant for the claims issuance phase: GetOutputClaimsIdentity. The
GetOutputClaimsIdentity method is invoked after GetScope and determines what
claims will be provided in the issued token.</p>

<p class=MsoNormal>This sample also demonstrates how a simple WCF service can
be configured to leverage the claims-based model introduced by the Microsoft
“Geneva” Framework.</p>

<h2>Projects included in the sample</h2>

<table class=MsoNormalTable border=0 cellspacing=0 cellpadding=0
 style='border-collapse:collapse'>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'><b>SimpleActiveSTS</b></p>
  </td>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin-bottom:6.0pt;line-height:normal'>A
  SecurityTokenService run as a console application.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'><b>ClaimsAwareWebService</b></p>
  </td>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin-bottom:6.0pt;line-height:normal'>A WCF web
  service that enumerates claims using the ClaimsPrincipal class.</p>
  </td>
 </tr>
 <tr>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin-bottom:0in;margin-bottom:.0001pt;line-height:
  normal'><b>Client</b></p>
  </td>
  <td valign=top style='padding:0in 5.4pt 0in 5.4pt'>
  <p class=MsoNormal style='margin-bottom:6.0pt;line-height:normal'>A WCF
  client that communicates with the ClaimsAwareWebService using a token issued
  by SimpleActiveSTS.</p>
  </td>
 </tr>
</table>

<h2>Steps needed to run the sample</h2>

<p class=MsoListParagraph style='margin-left:.5in;text-indent:-.25in'>1.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open
the solution file for this sample. If you are using Visual Studio 2008, open SimpleSTSForActiveClients-VS2008.sln.
If you are using Visual Studio 2005, open SimpleSTSForActiveClients-VS2005.sln.</p>

<p class=MsoListParagraph style='margin-left:.5in;text-indent:-.25in'>2.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Build
the solution.</p>

<p class=MsoListParagraph style='margin-left:.5in;text-indent:-.25in'>3.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>Open
three command prompts with administrative privileges.</p>

<p class=MsoListParagraph style='margin-left:1.0in;text-indent:-.25in'>a.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In
command prompt #1, execute SimpleActiveSTS.exe in the bin folder for that
project. You should see the following the following message on the command
prompt:</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
margin-left:1.0in;margin-right:0in'>

<p class=ConsoleOutput>SimpleActiveSTS started, press ENTER to stop...</p>

</div>

<p class=MsoListParagraph style='margin-left:1.0in;text-indent:-.25in'>b.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In
command prompt #2, execute ClaimsAwareWebService.exe in the bin folder for that
project. You should see the following message on the command prompt:</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
margin-left:1.0in;margin-right:0in'>

<p class=ConsoleOutput>ClaimsAwareWebService started, press ENTER to stop...</p>

</div>

<p class=MsoListParagraph style='margin-left:1.0in;text-indent:-.25in'>c.<span
style='font:7.0pt "Times New Roman"'>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; </span>In
command prompt #3, execute Client.exe in the bin folder for that project. You
should see the following message on the command prompt:</p>

<div style='border:solid windowtext 1.0pt;padding:1.0pt 4.0pt 1.0pt 4.0pt;
margin-left:1.0in;margin-right:0in'>

<p class=ConsoleOutput>Computed by ClaimsAwareWebService for <i>&lt;username&gt;</i>:
Hello World</p>

</div>

<p class=MsoNormal style='margin-left:1.0in'>The claims issued by the STS will
be shown on command prompt #1 and the claims received by the relying party will
be shown on command prompt #2 during the execution of Client.exe</p>

<h2>Troubleshooting tips</h2>

<p class=MsoNormal>If the port specified for the services in this sample is
already in use, you will see exceptions indicating that the port is already in
use. The STS (SimpleActiveSTS) is configured to use port 6000 and the relying party
(ClaimsAwareWebService) is configured to use port 6020. To change these, open
the solution file and replace the port numbers with free ports on your machine.</p>

</div>

</body>

</html>
